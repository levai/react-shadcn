---
alwaysApply: true
description: åç«¯é¡¹ç›®æ ¸å¿ƒå¼€å‘è§„èŒƒå’Œæ¶æ„æŒ‡å¯¼åŸåˆ™
---

# åç«¯å¼€å‘è§„èŒƒ

> ğŸ“– **è¯¦ç»†è§„èŒƒ**: å®Œæ•´è§„èŒƒè¯·æŸ¥çœ‹ [`docs/rules/ai-instructions.md`](../../docs/rules/ai-instructions.md)

æœ¬é¡¹ç›®ä½¿ç”¨ **åˆ†å±‚æ¶æ„** æ¨¡å¼ï¼Œç¬¦åˆ FastAPI å’Œ Python åç«¯å¼€å‘æœ€ä½³å®è·µã€‚

## æŠ€æœ¯æ ˆ

- FastAPI 0.128+ (Web æ¡†æ¶)
- SQLAlchemy 2.0.45+ (ORM)
- Pydantic 2.12+ (æ•°æ®éªŒè¯)
- Python 3.12+ (ç¼–ç¨‹è¯­è¨€)
- structlog 25.5+ (ç»“æ„åŒ–æ—¥å¿—)
- python-jose 3.5+ (JWT è®¤è¯)
- Alembic 1.15+ (æ•°æ®åº“è¿ç§»)
- Uvicorn 0.40+ (ASGI æœåŠ¡å™¨)

## ç›®å½•ç»“æ„

```
app/
â”œâ”€â”€ api/              # API è·¯ç”±å±‚ï¼ˆControllerï¼‰
â”‚   â””â”€â”€ v1/
â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServiceï¼‰
â”œâ”€â”€ repositories/     # æ•°æ®è®¿é—®å±‚ï¼ˆRepositoryï¼‰â­
â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹å±‚ï¼ˆORM Modelï¼‰
â”œâ”€â”€ schemas/          # æ•°æ®éªŒè¯å±‚ï¼ˆSchemaï¼‰
â”œâ”€â”€ core/             # æ ¸å¿ƒé…ç½®
â”‚   â””â”€â”€ unit_of_work.py  # Unit of Work â­
â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
```

## æ ¸å¿ƒè§„åˆ™

### åˆ†å±‚æ¶æ„

**å¿…é¡»éµå¾ªåˆ†å±‚æ¶æ„åŸåˆ™ï¼š**

```
Router (API Layer)      # åªå¤„ç† HTTP è¯·æ±‚/å“åº”
    â†“
Service (Business Logic) # ä¸šåŠ¡é€»è¾‘å¤„ç†
    â†“
Unit of Work            # äº‹åŠ¡ç®¡ç† â­
    â†“
Repository              # æ•°æ®è®¿é—®æŠ½è±¡ â­
    â†“
Model (ORM)             # æ•°æ®åº“æ¨¡å‹
    â†“
Database
```

### å¯¼å…¥è§„åˆ™

**å¿…é¡»ä½¿ç”¨ç»å¯¹å¯¼å…¥ï¼Œç¦æ­¢ç›¸å¯¹è·¯å¾„ï¼š**

```python
# âœ… æ­£ç¡®
from app.services.auth_service import AuthService
from app.core.dependencies import get_auth_service

# âŒ é”™è¯¯
from ..services.auth_service import AuthService
```

### æœåŠ¡å±‚è§„èŒƒ

**ä¸šåŠ¡é€»è¾‘å¿…é¡»åœ¨æœåŠ¡å±‚ï¼Œç¦æ­¢åœ¨è·¯ç”±å±‚ï¼š**

```python
# âœ… æ­£ç¡®ï¼šè·¯ç”±å±‚åªå¤„ç† HTTP
@router.post("/login")
async def login(
    login_data: UserLogin,
    auth_service: AuthService = Depends(get_auth_service),
):
    return auth_service.login(login_data.username, login_data.password)

# âŒ é”™è¯¯ï¼šä¸šåŠ¡é€»è¾‘åœ¨è·¯ç”±å±‚
@router.post("/login")
async def login(login_data: UserLogin, db: Session = Depends(get_db)):
    user = db.query(User).filter(...).first()  # âŒ
```

### å¼‚å¸¸å¤„ç†è§„èŒƒ

**å¿…é¡»ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œç¦æ­¢ç›´æ¥æŠ›å‡º HTTPExceptionï¼š**

```python
# âœ… æ­£ç¡®
from app.core.exceptions import NotFoundError

def get_user(self, user_id: str):
    if not user:
        raise NotFoundError("ç”¨æˆ·ä¸å­˜åœ¨")

# âŒ é”™è¯¯
from fastapi import HTTPException
raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")  # âŒ
```

### æ—¥å¿—è®°å½•è§„èŒƒ

**åœ¨æœåŠ¡å±‚ä½¿ç”¨æ—¥å¿—ï¼š**

```python
from app.services.base_service import BaseService

class MyService(BaseService):
    def some_method(self):
        self.logger.info("æ“ä½œå¼€å§‹", user_id=123)
        self.logger.error("æ“ä½œå¤±è´¥", error=str(e))
```

## å…³é”®è§„åˆ™æ€»ç»“

1. âœ… éµå¾ªåˆ†å±‚æ¶æ„ï¼ˆRouter â†’ Service â†’ Unit of Work â†’ Repository â†’ Modelï¼‰
2. âœ… ä¸šåŠ¡é€»è¾‘åœ¨æœåŠ¡å±‚ï¼Œè·¯ç”±å±‚åªå¤„ç† HTTP
3. âœ… ä½¿ç”¨ Repository Patternï¼Œç¦æ­¢æœåŠ¡å±‚ç›´æ¥ä½¿ç”¨ ORM â­
4. âœ… ä½¿ç”¨ Unit of Work Pattern ç®¡ç†äº‹åŠ¡ â­
5. âœ… ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œç¦æ­¢ç›´æ¥æŠ›å‡º HTTPException
6. âœ… ä½¿ç”¨ä¾èµ–æ³¨å…¥è·å–æœåŠ¡
7. âœ… ä½¿ç”¨ Pydantic Schema è¿›è¡Œæ•°æ®éªŒè¯
8. âœ… ä½¿ç”¨ç±»å‹æç¤º
9. âœ… åœ¨æœåŠ¡å±‚è®°å½•æ—¥å¿—
10. âœ… ä½¿ç”¨ç»å¯¹å¯¼å…¥

## è¯¦ç»†è§„èŒƒ

**ç»Ÿä¸€è§„èŒƒæºæ–‡ä»¶ï¼ˆåŒ…å«æ‰€æœ‰æ–‡æ¡£é“¾æ¥ï¼‰ï¼š**
- **[AI ç¼–ç¨‹åŠ©æ‰‹ç»Ÿä¸€è§„èŒƒ](../../docs/rules/ai-instructions.md)** - æ‰€æœ‰è¯¦ç»†è§„åˆ™ã€ä»£ç ç¤ºä¾‹å’Œå®Œæ•´æ–‡æ¡£åˆ—è¡¨ï¼ˆ**å”¯ä¸€ç»´æŠ¤æº**ï¼‰
